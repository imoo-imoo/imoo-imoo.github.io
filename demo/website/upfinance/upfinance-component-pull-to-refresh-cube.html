<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="theme-color" content="#222032" />
<title>UP Finance Pull-To-Refresh with Dark BG Cube</title>
<style>
  :root{
    --ptr-height: 80px;     /* Indicator pull-out height/trigger threshold */
    --size: 20px;           /* Cube size */
    --duration: 800ms;     /* Single direction flip duration */
  }

  html, body { height: 100%; margin: 0; }
  body {
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang TC", "Microsoft JhengHei", Arial, "Noto Sans", "Helvetica Neue", sans-serif;
    background:#222032;
  }

  /* 整頁容器 */
  .ptr-shell {
    position: fixed; 
    inset: 0; 
    display: flex; 
    flex-direction: column;
    background:#222032;
  }

  .ptr-indicator{
    height: var(--ptr-height);
    display:flex; align-items:center; justify-content:center;
    transform: translateY(calc(-1 * var(--ptr-height)));
    opacity: 0;
    transition: opacity .4s linear, transform .4s ease;
    pointer-events: none;
  }

  .stage{ perspective: 900px; perspective-origin: 50% 50%; }

  .cube{
    width: var(--size);
    height: var(--size);
    background: #353246;
    opacity: 1;
    border-radius: 0px;
    transform-style: preserve-3d;
    /*box-shadow: 0 10px 30px rgba(0,0,0,.2);*/
    position: relative;
    will-change: transform, filter, box-shadow;
  }
  .cube::after{
    content:"";
    position:absolute; inset:0;
    border-radius:0px;
    /*box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);*/
    pointer-events:none;
  }

  .ptr-shell.refreshing .ptr-indicator { transform: translateY(0); opacity:1; }
  .ptr-shell.refreshing .ptr-scroll    { transform: translateY(var(--ptr-height)); }
  .ptr-shell.refreshing .cube{
    animation: tumble calc(var(--duration)*4) cubic-bezier(.42,0,.2,1) infinite;
  }

  @keyframes tumble{
    0%   { transform: rotateX(0)        rotateY(0);        filter: brightness(1);   }
    12.5%{ transform: rotateX(-90deg)   rotateY(0);        filter: brightness(1); }
    25%  { transform: rotateX(-180deg)  rotateY(0);        filter: brightness(1); }
    37.5%{ transform: rotateX(-180deg)  rotateY(90deg);    filter: brightness(1); }
    50%  { transform: rotateX(-180deg)  rotateY(180deg);   filter: brightness(1);   }
    62.5%{ transform: rotateX(-90deg)   rotateY(180deg);   filter: brightness(1); }
    75%  { transform: rotateX(0)        rotateY(180deg);   filter: brightness(1); }
    87.5%{ transform: rotateX(0)        rotateY(90deg);    filter: brightness(1); }
    100% { transform: rotateX(0)        rotateY(0);        filter: brightness(1);   }
  }

  .ptr-scroll{
    flex: 1 1 auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
    transform: translateY(0);
    transition: transform .4s ease;
    background:#222032;
  }

  .hero {
    height: 160px;
    background: linear-gradient(135deg, #2a283b, #2a283b);
    color:#dde1ec; 
    display:flex; 
    text-align: center;
    align-items:center; 
    justify-content:center;
    font-size: 34px; 
    font-weight: 700;
    line-height: 32px;
    margin-bottom: 10px;
  }
  .section { 
    padding: 16px; 
  }
  .card {
    border:1px solid #ffffff10;
    border-radius:12px;
    padding:20px;
    margin-bottom:20px;
    background:#ffffff05;
    color:#dde1ec;
    font-size: 14px;
  }
  .card b{
    color:#dde1ec;
    line-height: 18px;
    font-size: 14px;
  }
  .card span{
    color:#dde1ec50;
    line-height: 18px;
    font-size: 12px;
  }
</style>
</head>


<body>
  <div class="ptr-shell" id="ptrShell">
    <div class="ptr-indicator" id="ptrIndicator">
      <div class="stage"><div class="cube" aria-label="refresh indicator"></div></div>
    </div>

    <div class="ptr-scroll" id="ptrScroll">
      <div class="hero">REFRESH ME<br>MY FRIEND</div>
      <div class="section">
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
        <div class="card"><b>Card</b><br/><span>Donec eget dui at sem finibus luctus non eget urna. Donec semper massa quis molestie molestie.</span></div>
      </div>
    </div>
  </div>

<script>
(() => {
  const shell = document.getElementById('ptrShell');
  const scroll = document.getElementById('ptrScroll');
  const indicator = document.getElementById('ptrIndicator');

  const THRESHOLD = parseInt(
    getComputedStyle(document.documentElement).getPropertyValue('--ptr-height')
  ) || 84;

  let startY = 0, pulling = false, pulled = 0, refreshing = false;

  const canStartPull = () => scroll.scrollTop <= 0 && !refreshing;

  function renderPull(distance){
    const clamped  = Math.max(0, Math.min(distance, THRESHOLD * 1.25));
    const progress = Math.min(1, clamped / THRESHOLD);
    indicator.style.transform = `translateY(${clamped - THRESHOLD}px)`;
    indicator.style.opacity   = progress.toFixed(2);
    scroll.style.transform    = `translateY(${clamped}px)`;
  }

  async function doRefresh(){
    refreshing = true;
    shell.classList.add('refreshing');
    await new Promise(r => setTimeout(r, 4000)); // Simulated Refresh
    shell.classList.remove('refreshing');
    indicator.style.transform = `translateY(${-THRESHOLD}px)`;
    indicator.style.opacity   = 0;
    scroll.style.transform    = 'translateY(0)';
    refreshing = false;
  }

  scroll.addEventListener('touchstart', (e) => {
    if (!canStartPull()) return;
    startY = e.touches[0].clientY;
    pulling = true; pulled = 0;
  }, { passive: true });

  scroll.addEventListener('touchmove', (e) => {
    if (!pulling) return;
    const delta = e.touches[0].clientY - startY;
    if (delta > 0){
      e.preventDefault();
      pulled = delta * 0.6;
      renderPull(pulled);
    } else {
      pulling = false; renderPull(0);
    }
  }, { passive: false });

  scroll.addEventListener('touchend', () => {
    if (!pulling) return;
    pulling = false;
    if (pulled >= THRESHOLD) doRefresh();
    else {
      indicator.style.transform = `translateY(${-THRESHOLD}px)`;
      indicator.style.opacity   = 0;
      scroll.style.transform    = 'translateY(0)';
    }
    pulled = 0;
  });
})();
</script>
</body>
</html>
